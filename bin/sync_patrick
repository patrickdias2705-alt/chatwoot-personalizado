#!/bin/bash

# Script para sincronizar automaticamente com o reposit√≥rio patrick no GitHub
# Uso: ./bin/sync_patrick [mensagem do commit]

set -e

# Cores para output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m' # No Color

REMOTE="patrick"
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

echo -e "${BLUE}üîÑ Sincronizando com reposit√≥rio patrick...${NC}"

# Verificar se h√° mudan√ßas
if [ -z "$(git status --porcelain)" ]; then
    echo -e "${YELLOW}‚ö†Ô∏è  Nenhuma mudan√ßa para commitar${NC}"
else
    echo -e "${YELLOW}üìù Mudan√ßas detectadas, fazendo commit...${NC}"
    
    # Mensagem do commit
    if [ -z "$1" ]; then
        COMMIT_MSG="Update: $(date '+%Y-%m-%d %H:%M:%S')"
    else
        COMMIT_MSG="$1"
    fi
    
    # Adicionar todas as mudan√ßas
    git add -A
    
    # Fazer commit
    git commit -m "$COMMIT_MSG" || {
        echo -e "${RED}‚ùå Erro ao fazer commit${NC}"
        exit 1
    }
    
    echo -e "${GREEN}‚úÖ Commit criado: $COMMIT_MSG${NC}"
fi

# Verificar se a branch atual existe no remoto
echo -e "${BLUE}üì§ Fazendo push para $REMOTE/$CURRENT_BRANCH...${NC}"

# Fazer push (force se necess√°rio para main/develop)
if [ "$CURRENT_BRANCH" = "main" ] || [ "$CURRENT_BRANCH" = "develop" ]; then
    git push $REMOTE $CURRENT_BRANCH --force-with-lease || {
        echo -e "${RED}‚ùå Erro ao fazer push${NC}"
        exit 1
    }
else
    git push $REMOTE $CURRENT_BRANCH || {
        echo -e "${RED}‚ùå Erro ao fazer push${NC}"
        exit 1
    }
fi

echo -e "${GREEN}‚úÖ Sincroniza√ß√£o conclu√≠da!${NC}"
echo -e "${BLUE}üîó Reposit√≥rio: https://github.com/patrickdias2705-alt/chatwoot${NC}"

